<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
   xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
   xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
   xmlns:strings="clr-namespace:TwentyFortyEight.Maui.Resources.Strings"
   xmlns:vm="clr-namespace:TwentyFortyEight.ViewModels;assembly=TwentyFortyEight.ViewModels"
   x:Class="TwentyFortyEight.Maui.SettingsPage"
   x:DataType="vm:SettingsViewModel"
   Title="{x:Static strings:AppStrings.SettingsPageTitle}"
   Background="{AppThemeBinding Light={StaticResource GamePageBackgroundLight}, Dark={StaticResource GamePageBackgroundDark}}">

   <ScrollView Padding="20">
      <VerticalStackLayout Spacing="20">

         <!-- Animations Section -->
         <Border x:Name="AnimationsSectionBorder"
            Background="{AppThemeBinding Light={StaticResource GamePanelBackgroundLight}, Dark={StaticResource GamePanelBackgroundDark}}"
            Stroke="Transparent"
            StrokeShape="RoundRectangle 10"
            Padding="16">
            <VerticalStackLayout Spacing="12">
               <Label x:Name="AnimationsSectionLabel"
                  Text="{x:Static strings:AppStrings.AnimationsSection}"
                  FontSize="12"
                  FontAttributes="Bold"
                  TextColor="{AppThemeBinding Light=#eee4da, Dark=#cdc1b4}"
                  Margin="0,0,0,4" />

               <!-- Enable Animations Toggle -->
               <Grid x:Name="AnimationsToggleGrid"
                     ColumnDefinitions="*,Auto"
                     ColumnSpacing="10">
                  <Label x:Name="EnableAnimationsLabel"
                     Grid.Column="0"
                     Text="{x:Static strings:AppStrings.EnableAnimations}"
                     FontSize="15"
                     TextColor="{AppThemeBinding Light={StaticResource TileTextDark}, Dark={StaticResource TileTextLight}}"
                     VerticalOptions="Center" />
                  <Switch x:Name="AnimationsEnabledSwitch"
                     AutomationId="AnimationsEnabledSwitch"
                     Grid.Column="1"
                     IsToggled="{Binding AnimationsEnabled}"
                     OnColor="{AppThemeBinding Light=#8f7a66, Dark=#5a4a3a}"
                     ThumbColor="White"
                     VerticalOptions="Center"
                     SemanticProperties.Description="{x:Static strings:AppStrings.EnableAnimations}"
                     SemanticProperties.Hint="{x:Static strings:AppStrings.EnableAnimationsHint}" />
               </Grid>

               <!-- Animation Speed Slider -->
               <VerticalStackLayout Spacing="8" IsVisible="{Binding AnimationsEnabled}">
                  <Label
                     Text="{x:Static strings:AppStrings.AnimationSpeed}"
                     FontSize="15"
                     TextColor="{AppThemeBinding Light=#776e65, Dark=#f9f6f2}" />
                  
                  <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
                     <Label
                        Grid.Column="0"
                        Text="{x:Static strings:AppStrings.AnimationSpeedSlow}"
                        FontSize="12"
                        TextColor="{AppThemeBinding Light=#776e65, Dark=#cdc1b4}"
                        VerticalOptions="Center" />
                     <Slider
                        AutomationId="AnimationSpeedSlider"
                        Grid.Column="1"
                        Value="{Binding AnimationSpeed}"
                        Minimum="0.5"
                        Maximum="1.5"
                        MinimumTrackColor="{AppThemeBinding Light=#8f7a66, Dark=#5a4a3a}"
                        MaximumTrackColor="{AppThemeBinding Light=#cdc1b4, Dark=#776e65}"
                        ThumbColor="{AppThemeBinding Light=#8f7a66, Dark=#5a4a3a}"
                        VerticalOptions="Center"
                        SemanticProperties.Description="{x:Static strings:AppStrings.AnimationSpeed}"
                        SemanticProperties.Hint="{x:Static strings:AppStrings.AnimationSpeedHint}" />
                     <Label
                        Grid.Column="2"
                        Text="{x:Static strings:AppStrings.AnimationSpeedFast}"
                        FontSize="12"
                        TextColor="{AppThemeBinding Light=#776e65, Dark=#cdc1b4}"
                        VerticalOptions="Center" />
                  </Grid>

                  <Label
                     Text="{Binding AnimationSpeed, StringFormat='{0:F1}x'}"
                     FontSize="13"
                     FontAttributes="Bold"
                     TextColor="{AppThemeBinding Light=#776e65, Dark=#f9f6f2}"
                     HorizontalOptions="Center" />
               </VerticalStackLayout>
            </VerticalStackLayout>
         </Border>

         <!-- Haptics Section (conditionally visible) -->
         <Border x:Name="HapticsSectionBorder"
            Background="{AppThemeBinding Light={StaticResource GamePanelBackgroundLight}, Dark={StaticResource GamePanelBackgroundDark}}"
            Stroke="Transparent"
            StrokeShape="RoundRectangle 10"
            Padding="16"
            IsVisible="{Binding IsHapticsSupported}">
            <VerticalStackLayout Spacing="12">
               <Label x:Name="HapticsSectionLabel"
                  Text="{x:Static strings:AppStrings.HapticsSection}"
                  FontSize="12"
                  FontAttributes="Bold"
                  TextColor="{AppThemeBinding Light=#eee4da, Dark=#cdc1b4}"
                  Margin="0,0,0,4" />

               <!-- Enable Haptics Toggle -->
               <Grid x:Name="HapticsToggleGrid"
                     ColumnDefinitions="*,Auto"
                     ColumnSpacing="10">
                  <Label x:Name="EnableHapticsLabel"
                     Grid.Column="0"
                     Text="{x:Static strings:AppStrings.EnableHaptics}"
                     FontSize="15"
                     TextColor="{AppThemeBinding Light={StaticResource TileTextDark}, Dark={StaticResource TileTextLight}}"
                     VerticalOptions="Center" />
                  <Switch x:Name="HapticsEnabledSwitch"
                     AutomationId="HapticsEnabledSwitch"
                     Grid.Column="1"
                     IsToggled="{Binding HapticsEnabled}"
                     OnColor="{AppThemeBinding Light=#8f7a66, Dark=#5a4a3a}"
                     ThumbColor="White"
                     VerticalOptions="Center"
                     SemanticProperties.Description="{x:Static strings:AppStrings.EnableHaptics}"
                     SemanticProperties.Hint="{x:Static strings:AppStrings.EnableHapticsHint}" />
               </Grid>
            </VerticalStackLayout>
         </Border>

         <!-- Remove Ads Section (conditionally visible when ads are supported and not removed) -->
         <Border x:Name="RemoveAdsSectionBorder"
            Background="{AppThemeBinding Light={StaticResource GamePanelBackgroundLight}, Dark={StaticResource GamePanelBackgroundDark}}"
            Stroke="Transparent"
            StrokeShape="RoundRectangle 10"
            Padding="16"
            IsVisible="{Binding ShowRemoveAdsSection}">
            <VerticalStackLayout Spacing="12">
               <Label x:Name="RemoveAdsSectionLabel"
                  Text="{x:Static strings:AppStrings.RemoveAdsSection}"
                  FontSize="12"
                  FontAttributes="Bold"
                  TextColor="{AppThemeBinding Light=#eee4da, Dark=#cdc1b4}"
                  Margin="0,0,0,4" />

               <Label x:Name="RemoveAdsDescriptionLabel"
                  Text="{x:Static strings:AppStrings.RemoveAdsDescription}"
                  FontSize="14"
                  TextColor="{AppThemeBinding Light=#776e65, Dark=#f9f6f2}"
                  LineBreakMode="WordWrap" />

               <!-- Purchase Button -->
               <Button x:Name="PurchaseRemoveAdsButton"
                  AutomationId="PurchaseRemoveAdsButton"
                  Command="{Binding PurchaseRemoveAdsCommand}"
                  Text="{Binding RemoveAdsPrice, StringFormat='Remove Ads - {0}', TargetNullValue='Remove Ads'}"
                  Background="{AppThemeBinding Light={StaticResource GameButtonBackgroundLight}, Dark={StaticResource GameButtonBackgroundDark}}"
                  TextColor="White"
                  HeightRequest="50"
                  Padding="20,0"
                  CornerRadius="5"
                  IsEnabled="{Binding IsPurchaseInProgress, Converter={StaticResource InvertedBoolConverter}}"
                  SemanticProperties.Description="{x:Static strings:AppStrings.RemoveAdsDescription}" />

               <!-- Restore Purchases Button -->
               <Button x:Name="RestorePurchasesButton"
                  AutomationId="RestorePurchasesButton"
                  Command="{Binding RestorePurchasesCommand}"
                  Text="{x:Static strings:AppStrings.RestorePurchases}"
                  Background="Transparent"
                  BorderColor="{AppThemeBinding Light=#8f7a66, Dark=#5a4a3a}"
                  BorderWidth="1"
                  TextColor="{AppThemeBinding Light=#8f7a66, Dark=#cdc1b4}"
                  HeightRequest="44"
                  Padding="20,0"
                  CornerRadius="5"
                  IsEnabled="{Binding IsPurchaseInProgress, Converter={StaticResource InvertedBoolConverter}}"
                  SemanticProperties.Description="{x:Static strings:AppStrings.RestorePurchasesDescription}" />

               <!-- Loading Indicator -->
               <ActivityIndicator
                  IsRunning="{Binding IsPurchaseInProgress}"
                  IsVisible="{Binding IsPurchaseInProgress}"
                  Color="{AppThemeBinding Light=#8f7a66, Dark=#5a4a3a}"
                  HeightRequest="30"
                  HorizontalOptions="Center" />
            </VerticalStackLayout>
         </Border>

      </VerticalStackLayout>
   </ScrollView>
</ContentPage>
